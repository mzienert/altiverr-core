"use strict";var n=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var g=(e,s)=>{for(var i in s)n(e,i,{get:s[i],enumerable:!0})},y=(e,s,i,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of h(s))!A.call(e,o)&&o!==i&&n(e,o,{get:()=>s[o],enumerable:!(r=u(s,o))||r.enumerable});return e};var O=e=>y(n({},"__esModule",{value:!0}),e);var k={};g(k,{handler:()=>C});module.exports=O(k);var t={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Methods":"OPTIONS,POST,GET","Access-Control-Allow-Credentials":"true"},C=async e=>{if(e.httpMethod==="OPTIONS")return{statusCode:200,headers:t,body:""};let s=e.headers.origin||e.headers.Origin,i=(process.env.ALLOWED_ORIGIN||"").split(","),r=s&&i.includes(s)?s:i[0];if(e.resource==="/auth/session/verify"){console.log("Headers:",JSON.stringify(e.headers,null,2)),console.log("Cookie header:",e.headers.Cookie||e.headers.cookie),console.log("All header keys:",Object.keys(e.headers));let o=e.headers.Cookie||e.headers.cookie;if(console.log("Raw cookies:",o),o){let a=l(o);console.log("Parsed cookies:",a)}return{statusCode:200,headers:{...t,"Access-Control-Allow-Origin":r},body:JSON.stringify({cookiesPresent:!!o,cookies:o?l(o):null,headers:e.headers,debug:{headerKeys:Object.keys(e.headers),cookieHeader:e.headers.Cookie||e.headers.cookie,allHeaders:e.headers}})}}if(e.httpMethod==="POST")try{if(!e.body)return{statusCode:400,headers:{...t,"Access-Control-Allow-Origin":r},body:JSON.stringify({message:"Missing request body"})};let{accessToken:o,idToken:a}=JSON.parse(e.body);return{statusCode:200,multiValueHeaders:{"Set-Cookie":[`accessToken=${o}; HttpOnly; Secure; Path=/; SameSite=None; Max-Age=3600`,`idToken=${a}; HttpOnly; Secure; Path=/; SameSite=None; Max-Age=3600`],"Access-Control-Allow-Origin":[r],"Access-Control-Allow-Credentials":["true"],"Access-Control-Allow-Headers":[t["Access-Control-Allow-Headers"]],"Access-Control-Allow-Methods":[t["Access-Control-Allow-Methods"]]},body:JSON.stringify({success:!0})}}catch(o){return console.error("Error:",o),{statusCode:500,headers:{...t,"Access-Control-Allow-Origin":r},body:JSON.stringify({message:"Internal server error"})}}try{if(!e.body)return{statusCode:400,headers:{...t,"Access-Control-Allow-Origin":r},body:JSON.stringify({message:"Missing request body"})};let{accessToken:o,idToken:a}=JSON.parse(e.body);if(!o||!a)return{statusCode:400,headers:{...t,"Access-Control-Allow-Origin":r},body:JSON.stringify({message:"Missing required tokens"})};let c={httpOnly:!0,secure:!0,sameSite:"none",maxAge:24*60*60*1e3};return{statusCode:200,headers:{"Set-Cookie":[`accessToken=${o}; ${d(c)}`,`idToken=${a}; ${d(c)}`].join("; "),...t,"Access-Control-Allow-Origin":r},body:JSON.stringify({success:!0})}}catch{return{statusCode:500,headers:{...t,"Access-Control-Allow-Origin":r},body:JSON.stringify({message:"Internal server error"})}}};function l(e){return e.split(";").map(s=>s.trim()).reduce((s,i)=>{let[r,o]=i.split("=");return s[r]=o,s},{})}function d(e){let s=[];return e.httpOnly&&s.push("HttpOnly"),e.secure&&s.push("Secure"),e.sameSite&&s.push(`SameSite=${e.sameSite}`),e.maxAge&&s.push(`Max-Age=${Math.floor(e.maxAge/1e3)}`),e.domain&&s.push(`Domain=${e.domain}`),e.path&&s.push(`Path=${e.path}`),s.join("; ")}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
