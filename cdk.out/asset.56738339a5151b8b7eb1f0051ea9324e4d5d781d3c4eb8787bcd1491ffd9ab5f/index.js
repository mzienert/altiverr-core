"use strict";var a=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var y=(e,s)=>{for(var t in s)a(e,t,{get:s[t],enumerable:!0})},A=(e,s,t,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of u(s))!g.call(e,o)&&o!==t&&a(e,o,{get:()=>s[o],enumerable:!(r=d(s,o))||r.enumerable});return e};var C=e=>A(a({},"__esModule",{value:!0}),e);var O={};y(O,{handler:()=>h});module.exports=C(O);var h=async e=>{let s=e.headers.origin||e.headers.Origin,t=(process.env.ALLOWED_ORIGIN||"").split(","),r=s&&t.includes(s)?s:t[0];if(e.resource==="/auth/session/verify"){console.log("Headers:",JSON.stringify(e.headers,null,2));let o=e.headers.Cookie||e.headers.cookie;if(console.log("Raw cookies:",o),o){let i=c(o);console.log("Parsed cookies:",i)}return{statusCode:200,headers:{"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({cookiesPresent:!!o,cookies:o?c(o):null,headers:e.headers})}}if(e.httpMethod==="POST")try{if(!e.body)return{statusCode:400,headers:{"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Missing request body"})};let{accessToken:o,idToken:i}=JSON.parse(e.body),n="HttpOnly; Path=/";return{statusCode:200,headers:{"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true","Set-Cookie":[`accessToken=${o}; ${n}`,`idToken=${i}; ${n}`].join(", "),"Content-Type":"application/json"},body:JSON.stringify({success:!0,debug:{cookiesSent:!0,cookieString:`accessToken=${o}; ${n}`}})}}catch(o){return console.error("Error:",o),{statusCode:500,headers:{"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Internal server error"})}}try{if(!e.body)return{statusCode:400,headers:{"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Missing request body"})};let{accessToken:o,idToken:i}=JSON.parse(e.body);if(!o||!i)return{statusCode:400,headers:{"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Missing required tokens"})};let n={httpOnly:!0,secure:!0,sameSite:"strict",maxAge:24*60*60*1e3};return{statusCode:200,headers:{"Set-Cookie":[`accessToken=${o}; ${l(n)}`,`idToken=${i}; ${l(n)}`].join("; "),"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({success:!0})}}catch{return{statusCode:500,headers:{"Access-Control-Allow-Origin":r,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Internal server error"})}}};function c(e){return e.split(";").map(s=>s.trim()).reduce((s,t)=>{let[r,o]=t.split("=");return s[r]=o,s},{})}function l(e){let s=[];return e.httpOnly&&s.push("HttpOnly"),e.secure&&s.push("Secure"),e.sameSite&&s.push(`SameSite=${e.sameSite}`),e.maxAge&&s.push(`Max-Age=${Math.floor(e.maxAge/1e3)}`),e.domain&&s.push(`Domain=${e.domain}`),e.path&&s.push(`Path=${e.path}`),s.join("; ")}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
