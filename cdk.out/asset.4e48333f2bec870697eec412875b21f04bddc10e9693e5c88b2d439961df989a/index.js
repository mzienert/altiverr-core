"use strict";var a=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var A=(e,s)=>{for(var t in s)a(e,t,{get:s[t],enumerable:!0})},y=(e,s,t,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of u(s))!g.call(e,r)&&r!==t&&a(e,r,{get:()=>s[r],enumerable:!(o=d(s,r))||o.enumerable});return e};var C=e=>y(a({},"__esModule",{value:!0}),e);var O={};A(O,{handler:()=>h});module.exports=C(O);var h=async e=>{let s=e.headers.origin||e.headers.Origin,t=(process.env.ALLOWED_ORIGIN||"").split(","),o=s&&t.includes(s)?s:t[0];if(e.resource==="/auth/session/verify"){console.log("Headers:",JSON.stringify(e.headers,null,2));let r=e.headers.Cookie||e.headers.cookie;if(console.log("Raw cookies:",r),r){let i=l(r);console.log("Parsed cookies:",i)}return{statusCode:200,headers:{"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({cookiesPresent:!!r,cookies:r?l(r):null,headers:e.headers})}}if(e.httpMethod==="POST")try{if(!e.body)return{statusCode:400,headers:{"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Missing request body"})};let{accessToken:r,idToken:i}=JSON.parse(e.body),n="HttpOnly; Secure; Domain=.asaracing.live; Path=/";return{statusCode:200,headers:{"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true","Set-Cookie":[`accessToken=${r}; ${n}`,`idToken=${i}; ${n}`].join("; ")},body:JSON.stringify({success:!0})}}catch(r){return console.error("Error:",r),{statusCode:500,headers:{"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Internal server error"})}}try{if(!e.body)return{statusCode:400,headers:{"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Missing request body"})};let{accessToken:r,idToken:i}=JSON.parse(e.body);if(!r||!i)return{statusCode:400,headers:{"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Missing required tokens"})};let n={httpOnly:!0,secure:!0,sameSite:"strict",maxAge:24*60*60*1e3};return{statusCode:200,headers:{"Set-Cookie":[`accessToken=${r}; ${c(n)}`,`idToken=${i}; ${c(n)}`].join("; "),"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({success:!0})}}catch{return{statusCode:500,headers:{"Access-Control-Allow-Origin":o,"Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Internal server error"})}}};function l(e){return e.split(";").map(s=>s.trim()).reduce((s,t)=>{let[o,r]=t.split("=");return s[o]=r,s},{})}function c(e){let s=[];return e.httpOnly&&s.push("HttpOnly"),e.secure&&s.push("Secure"),e.sameSite&&s.push(`SameSite=${e.sameSite}`),e.maxAge&&s.push(`Max-Age=${Math.floor(e.maxAge/1e3)}`),e.domain&&s.push(`Domain=${e.domain}`),e.path&&s.push(`Path=${e.path}`),s.join("; ")}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
